<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>6D Address - Somalia Registration</title>
    <link rel="stylesheet" href="css/shared.css">
    <link rel="stylesheet" href="css/somalia-map.css">
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
</head>
<body>

    <div id="map"></div>
    <div id="loader" class="visible">
        <div class="spinner"></div>
        <p>Initializing Secure Map...</p>
    </div>

    <aside id="sidebar">
        <!-- State 1: Welcome / Initial View -->
        <div id="welcome-view" class="sidebar-view active">
            <div class="sidebar-header">
                <!-- LOGO PATH CORRECTED -->
                <img src="assets/logo-somalia.png" alt="6D Address Somalia Logo" class="logo">
                <h2>Welcome to 6D Address</h2>
            </div>
            <div class="sidebar-content">
                <p>Your official digital address is just a click away.</p>
                <h4>How it works:</h4>
                <ol>
                    <li>Click the button below to find your current location.</li>
                    <li>Alternatively, click anywhere on the map of Somalia.</li>
                    <li>Confirm your address details and register.</li>
                </ol>
                <button id="find-my-location-btn" class="btn btn-primary" disabled>
                    <span class="icon-location"></span> Find My 6D Address
                </button>
            </div>
        </div>

        <!-- State 2: Registration Form View -->
        <div id="registration-view" class="sidebar-view">
            <div class="sidebar-header">
                <!-- LOGO PATH CORRECTED -->
                <img src="assets/logo-somalia.png" alt="6D Address Somalia Logo" class="logo">
                <h2>Register Your Address</h2>
            </div>
            <div class="sidebar-content">
                <p class="form-intro">Confirm your location details and complete the form below.</p>
                
                <form id="registration-form" novalidate>
                    <div class="form-group readonly">
                        <label for="reg-6d-code">6D Address Code</label>
                        <input type="text" id="reg-6d-code" name="six_d_code" readonly>
                    </div>

                    <div class="form-group">
                        <label for="reg-region">Region</label>
                        <select id="reg-region" name="region" required></select>
                    </div>

                    <div class="form-group">
                        <label for="reg-district">District</label>
                        <select id="reg-district" name="district" required></select>
                    </div>
                    
                    <hr class="form-divider">

                    <div class="form-group">
                        <label for="reg-phone">Phone Number (e.g. 61xxxxxxx)</label>
                        <div class="phone-input-wrapper">
                            <span>+252</span>
                            <input type="tel" id="reg-phone" name="phone_number" placeholder="61xxxxxxx" required pattern="^[6-9]\d{7}$">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="reg-name">Full Name</label>
                        <input type="text" id="reg-name" name="full_name" placeholder="Your full name" required minlength="3">
                    </div>

                    <button type="submit" id="register-btn" class="btn btn-primary" disabled>Register</button>
                </form>
            </div>
        </div>
    </aside>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Confirm Registration</h3>
            <p>Please review your details before confirming.</p>
            <div class="confirmation-details">
                <div class="detail-item"><span>6D Code:</span> <strong id="confirm-6d-code"></strong></div>
                <div class="detail-item"><span>Location:</span> <strong id="confirm-location"></strong></div>
                <div class="detail-item"><span>Full Name:</span> <strong id="confirm-name"></strong></div>
                <div class="detail-item"><span>Phone:</span> <strong id="confirm-phone"></strong></div>
            </div>
            <div class="modal-actions">
                <button id="modal-cancel-btn" class="btn btn-secondary">Cancel</button>
                <button id="modal-confirm-btn" class="btn btn-primary">Confirm & Proceed</button>
            </div>
        </div>
    </div>

    <!-- 
      CRITICAL FIX: The Google Maps API script is now included.
      The API key will be injected here by the Netlify build script.
    -->
    <script id="google-maps-script" async></script>

    <!-- 
      CRITICAL FIX: All local scripts are now loaded with type="module" 
      to enable modern JavaScript import/export syntax.
    -->
    <script src="js/config.js" type="module"></script>
    <script src="js/utils.js" type="module"></script>
    <script src="js/map-core.js" type="module"></script>
    <script src="js/somalia-map.js" type="module"></script>

</body>
</html>